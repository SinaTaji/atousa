from django.core.cache import cache


def update_order_status(order):
    if not order.get_in_post and not order.finished:
        return

    if order.finished:
        return

    cache_key = f'order-{order.code}'
    still_in_post = cache.get(cache_key)

    if order.get_in_post and not still_in_post:
        order.get_in_post = False
        order.finished = True
        order.save(update_fields=['get_in_post', 'finished'])
        cache.delete(cache_key)


def message_type(type='default'):
    if type == 'welcome':
        return (
            'ุฎุฑุฏ ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ ๐'
            ' ูููููู ฺฉู ุขุชูุณุง ุฑู ุจุฑุง ุฎุฑุฏุชูู ุงูุชุฎุงุจ ฺฉุฑุฏุฏ.'
            ' ุณูุงุฑุด ุดูุง ุจุง ููููุช ุซุจุช ุดุฏ ู ุฏุฑ ุญุงู ุขูุงุฏูโุณุงุฒ ุจุฑุง ุงุฑุณุงู ุงุณุช.'
            '  ูโุชููุฏ ุฏุฑ ูุฑ ูุญุธู ุงุฒ ูุถุนุช ุณูุงุฑุดโุชูู ุฏุฑ ูพูู ฺฉุงุฑุจุฑ ูุทูุน ุจุดุฏ ู ูุฑุญูู ุจู ูุฑุญูู ุฑููุฏ ูพุฑุฏุงุฒุด ู ุงุฑุณุงู ุงูู ุฑู ูพฺฏุฑ ฺฉูุฏ.'
            ' ุงฺฏุฑ ุณูุงู ุง ูุดฺฉู ุฏุงุดุชุฏุ ุจุง ุงูุชุฎุงุฑ ุฏุฑ ฺฉูุงุฑุชูู ูุณุชู ๐'
        )
    if type == 'partner':
        return (
            "๐ ุฏุฑุฎูุงุณุช ููฺฉุงุฑ ุดูุง ุจุง ููููุช ูพุฐุฑูุชู ุดุฏ!\n"
            "ุฎูุดุญุงูู ฺฉู ุงุฒ ุงู ุจู ุจุนุฏ ฺฉูุงุฑููู ูุณุชุฏ ู ุจู ุฌูุน ููฺฉุงุฑุงู ุขุชูุณุง ูพูุณุชุฏ.\n"
            "ุญุงูุง ูโุชููุฏ ุงุฒ ุทุฑู ูพูู ฺฉุงุฑุจุฑ ุจู ุจุฎุด ููฺฉุงุฑ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ ู ูุนุงูุชโุชูู ุฑู ุขุบุงุฒ ฺฉูุฏ.\n"
            "ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ุฑุงูููุง ุง ูพุดุชุจุงูุ ุชู ูุง ููุดู ููุฑุงู ุดูุงุณุช ๐"
        )
    if type == 'rankup':
        return (
            "๐ ุชุจุฑฺฉ ุตููุงูู ูุง ุฑู ุจูพุฐุฑุฏ!\n"
            "ุจุง ุงูุชุฎุงุฑ ุงุนูุงู ูโฺฉูู ฺฉู ุฑุฏูโ ููฺฉุงุฑ ุดูุง ุฏุฑ ุขุชูุณุง ุงุฑุชูุง ูพุฏุง ฺฉุฑุฏู ๐\n"
            "ุงู ุงุฑุชูุง ูุชุฌูโ ูพุดุชฺฉุงุฑุ ุชุนูุฏ ู ููุฑุงู ุงุฑุฒุดููุฏ ุดูุงุณุช.\n"
            "ูุง ุจู ุญุถูุฑ ุดูุง ุฏุฑ ุฌูุน ููฺฉุงุฑุงู ุขุชูุณุง ุงูุชุฎุงุฑ ูโฺฉูู ู ูุฏุฑุฏุงู ุชูุงุดโูุง ุดูุง ูุณุชู.\n"
            "ุงูุฏูุงุฑู ุฏุฑ ูุณุฑ ูพุด ุฑูุ ุจุง ุงูุฑฺ ุจุดุชุฑ ู ููููุชโูุง ุจุฒุฑฺฏโุชุฑ ููุฑุงู ูุง ุจุงุดุฏ.\n"
            "ููุดู ฺฉูุงุฑ ุดูุง ูุณุชู ๐"
        )


def send_message(user, type='default'):
    from .models import ReplyContact
    ReplyContact.objects.create(
        user=user,
        text=message_type(type),
    )
